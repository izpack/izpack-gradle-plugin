plugins {
    id 'groovy'
    id 'java-gradle-plugin'
    id 'jvm-test-suite'
    id 'com.gradle.plugin-publish' version '2.0.0'
}

group = 'org.izpack'
version = '4.0.0'

repositories {
    mavenCentral()
}

java {
    withJavadocJar()
    withSourcesJar()
}

jar {
    manifest {
        attributes 'Implementation-Title': 'Gradle IzPack plugin',
                   'Implementation-Version': archiveVersion,
                   'Built-By': System.getProperty("user.name"),
                   'Built-Date': new Date(),
                   'Built-JDK': System.getProperty("java.version"),
                   'Built-Gradle': gradle.gradleVersion
    }
}

tasks.register('groovydocJar', Jar) {
    dependsOn groovydoc
    archiveClassifier = 'groovydoc'
    from groovydoc.destinationDir
}

testing {
    suites {
        functionalTest(JvmTestSuite) {
            useSpock()

            sources {
                groovy {
                    setSrcDirs(['src/functTest/groovy'])
                }
            }

            dependencies {
                implementation configurations.testRuntimeClasspath
                implementation('org.spockframework:spock-core:2.3-groovy-4.0') {
                    exclude group: 'org.codehaus.groovy'
                }
                implementation('org.junit.jupiter:junit-jupiter-api:6.0.0')
                runtimeOnly('org.junit.jupiter:junit-jupiter-engine:6.0.0')
            }
        }
    }
}

test {
    finalizedBy testing.suites.functionalTest
}

tasks.named("check") {
    dependsOn(testing.suites.functionalTest)
}

gradlePlugin {
    website = "https://github.com/izpack/izpack-gradle-plugin"
    vcsUrl = "https://github.com/izpack/izpack-gradle-plugin"
    plugins {
        create('izpack-plugin') {
            id = 'org.izpack'
            displayName = 'IzPack Gradle Plugin'
            description = 'Plugin that provides support for packaging applications for the Java platform via IzPack.'
            implementationClass = 'org.izpack.gradle.IzPackPlugin'
            tags = ['packaging', 'distribution', 'installer']
        }
    }
}
